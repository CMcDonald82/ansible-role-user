# ansible-role-user
Ansible role for creating a user on an Ubuntu server

## Requirements

None

## Role Variables

The following variables with their default values are listed below.

  deploy_username: deploy

  The password should be created externally to this role in an encrypted file using Ansible Vault. 
  You can create any number of these encrypted files so you can use different values for the vault_deploy_password variable for different servers
  Use the following command to create a hashed password that is stored in the vault.yml file as vault_deploy_password
  See http://docs.ansible.com/ansible/latest/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module
  This requires the Python package passlib to be installed
  ```
  python -c "from passlib.hash import sha512_crypt; import getpass; print sha512_crypt.using(rounds=5000).hash(getpass.getpass())"
  ```

  Create a variable vault_deploy_password in a vars file somewhere in your playbook that is using this role.
  I usually create a vault.yml file within the group_vars/all directory for the host that I am deploying to and put the vault_deploy_password variable in that file, then encrypt that file with Ansible Vault. This way, the variable is available to any role that the playbook deploying to that host uses. Obviously, you can override other variables in that file as well, or in the vars.yml file within group_vars/all (just make sure that any variable that is sensitive, such as any kind of password is in the vault.yml file, rather than the vars.yml file)
  Set the value of vault_deploy_password in that file to the password you just generated by running the python script above.
  Use Ansible Vault to encrypt the vars file (either use ansible vault create (if you haven't created the vars file) or ansible vault encrypt (if you've already created the vars file)).
  See https://docs.ansible.com/ansible/2.4/vault.html
  Use the encrypted vars file you created (containing the vault_deploy_password variable) in any playbook that uses this role by importing it via vars_files
  See http://docs.ansible.com/ansible/latest/playbooks_variables.html#variable-file-separation

  deploy_password: <stored in vars file as vault_deploy_password>

  This is the path to your public ssh key on your local machine. 
  public_key: ~/.ssh/id_rsa.pub


## Example Playbook
NOTE: This assumes the required vault_deploy_password variable has been set in a file within group_vars/all wherever this playbook is being run

- name: Setup Ubuntu server with PostgreSQL, Nginx, SSL, UFW for use with Phoenix app
  hosts: all
  remote_user: "{{ deploy_username }}"
  become: yes

  roles:
    - user_role


## Dependencies

None